<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Signup</title>

    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap"rel="stylesheet"/>
    <style>label {margin-top: 25px;}</style>

</head>

<body>
    <div class="background">
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <form id="signup-form">
    <h3>Signup Here</h3>
    <div class="name-container">
        <div>
            <label for="first-name">First Name</label>
            <input style="width: 155px" type="text" placeholder="First Name" id="first-name" required/>
        </div>`
        <div>
            <label for="second-name">Second Name</label>
            <input style="width: 155px" type="text" placeholder="Second Name" id="second-name" required/>
        </div>
    </div>

    <label for="email">Email</label>
    <input type="email" placeholder="Email" id="email" required />

    <label for="password">Password</label>
    <input type="password" placeholder="Password" id="password" required />

    <button type="submit">Create Account</button>

    <p class="login-message">Already have an account? <a href="login.html">Login</a></p>
    
    <!-- For Future Use
    <div class="social">
        <div class="go"><i class="fab fa-google"></i> Google</div>
        <div class="fb"><i class="fab fa-facebook"></i> Facebook</div>
    </div>
    -->
    </form>

    <!-- Confirmation Code Modal -->
    <div id="confirmation-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            
            <h3>Enter Confirmation Code Sent to your Email</h3>
            
            <label for="confirmation-code">Code</label>
            <input type="text" id="confirmation-code" required />
            
            <button id="confirm-button" onclick="confirmSignup()">Confirm</button>
        </div> 
    </div> 

    <script>
        document.getElementById('signup-form').addEventListener('submit', async function (event) {
        event.preventDefault();
    
        const firstName = document.getElementById('first-name').value;
        const secondName = document.getElementById('second-name').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
    
        try {
          const response = await fetch('https://w06kmhy9t3.execute-api.us-east-2.amazonaws.com/Development/signup', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              firstName: firstName,
              secondName: secondName,
              email: email,
              password: password
            })
          });
          
          const responseData = await response.json();
          console.log(responseData)
          const body = JSON.parse(responseData.body);
          const message = body.message;

          if (responseData.statusCode==200) {
            document.getElementById("confirmation-modal").style.display = "block";
          } else {
            alert('Signup failed: ' + message);
          }
        } catch (error) {
          alert('Error: ' + error.message);
        }
      });

// Function to close the modal
function closeModal() {
  document.getElementById("confirmation-modal").style.display = "none";
}

// Function to confirm signup
async function confirmSignup() {
  const email = document.getElementById("email").value; // Use the same email entered during signup
  const confirmationCode = document.getElementById("confirmation-code").value;

  const response = await fetch("https://w06kmhy9t3.execute-api.us-east-2.amazonaws.com/Development/confirm_code", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      email: email,
      confirmationCode: confirmationCode
    })
  });

  if (response.ok) {
    alert("Account confirmed successfully!");
    closeModal(); // Close the modal
    window.location.href = "login.html"; // Redirect to login page
  } else {
    const error = await response.json();
    alert(error.message);
  }
}      
    </script>
    

  </body>
</html>